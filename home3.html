<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home | BEATWAVE</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Poppins:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Sen:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #7209b7;
        --secondary: #f72585;
        --dark: #121212;
        --dark-secondary: #282828;
        --text: #ffffff;
        --text-secondary: #b3b3b3;
        --sidebar-width: 240px;
      }

      body {
        background: linear-gradient(135deg, #0f0c29, #302b63);
        color: var(--text);
        font-family: "Poppins", sans-serif;
        padding-top: 80px;
        padding-right: 260px;
        /* Không gian cho player ở bên phải */
        padding-left: var(--sidebar-width);
        /* Không gian cho sidebar ở bên trái */
        min-height: 100vh;
        margin: 0;
      }

      /* Navbar */
      .navbar-custom {
        background: rgba(18, 18, 18, 0.8);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-left: var(--sidebar-width);
        z-index: 100;
      }

      .logo {
        font-size: 2rem;
        background: linear-gradient(45deg, var(--secondary), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
      }

      .search-bar {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        padding: 8px 15px;
        width: 300px;
        transition: all 0.3s;
      }

      .search-bar:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .search-bar input {
        background: transparent;
        border: none;
        color: var(--text);
        outline: none;
      }

      .btn-login {
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        border: none;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(247, 37, 133, 0.4);
      }

      /* Album Cards */
      .card {
        background: rgba(40, 40, 40, 0.5);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s;
        cursor: pointer;
      }

      .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(114, 9, 183, 0.3);
        background: rgba(40, 40, 40, 0.8);
      }

      .card-img-top {
        width: 100%;
        height: 180px;
        object-fit: cover;
        transition: all 0.5s;
      }

      .card:hover .card-img-top {
        transform: scale(1.05);
      }

      .card-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: gray;
      }

      .card-text {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Player */
      .player-container {
        position: fixed;
        top: 80px;
        /* Để nó hiển thị dưới navbar */
        bottom: 0;
        right: 0;
        width: 240px;
        background: rgba(18, 18, 18, 0.9);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      #song-title {
        font-weight: 600;
        font-size: 0.9rem;
        background: linear-gradient(45deg, var(--secondary), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
        text-align: center;
      }

      audio {
        width: 100%;
        border-radius: 0;
        background: rgba(255, 255, 255, 0.1);
        height: 40px;
        margin-bottom: 10px;
      }

      audio::-webkit-media-controls-panel {
        background: rgba(255, 255, 255, 0.1);
      }

      .player-controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
      }

      .player-controls button {
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .player-controls button:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(247, 37, 133, 0.5);
      }

      /* Visualizer */
      .visualizer {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        height: 60px;
        gap: 3px;
        margin-bottom: 15px;
        width: 100%;
      }

      .bar {
        width: 4px;
        background: linear-gradient(to top, var(--primary), var(--secondary));
        border-radius: 2px;
        animation: equalize 1.5s infinite ease-in-out;
      }

      @keyframes equalize {
        0%,
        100% {
          height: 20%;
        }

        50% {
          height: 100%;
        }
      }

      /* Rotating Poster */
      .album-poster {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        overflow: hidden;
        margin: 0 auto 20px;
        box-shadow: 0 0 20px rgba(114, 9, 183, 0.4);
        position: relative;
        animation: float 3s infinite ease-in-out;
      }

      .album-poster img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        animation: rotate 20s linear infinite paused;
      }

      .album-poster.playing img {
        animation-play-state: running;
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }

        to {
          transform: rotate(360deg);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }

        50% {
          transform: translateY(-10px);
        }
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: var(--sidebar-width);
        background: rgba(18, 18, 18, 0.9);
        backdrop-filter: blur(10px);
        padding: 20px 0;
        z-index: 2000;
        display: flex;
        flex-direction: column;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .sidebar .logo i {
        font-size: 1.8rem;
        background: linear-gradient(45deg, var(--secondary), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .sidebar .logo a {
        font-size: 1.5rem;
        font-weight: 700;
        text-decoration: none;
        background: linear-gradient(45deg, var(--secondary), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .nav-top,
      .nav-bottom {
        padding: 0 10px;
      }

      .nav-top {
        margin-bottom: 30px;
      }

      .nav-bottom {
        margin-top: auto;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 20px;
      }

      .nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav li {
        margin-bottom: 5px;
      }

      .nav a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
        transition: all 0.3s;
      }

      .nav a:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--secondary);
      }

      .nav a i {
        font-size: 1.2rem;
      }

      /* Left header */
      .left-header {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text);
        border: none;
        transition: all 0.3s;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Responsive */
      @media (max-width: 992px) {
        :root {
          --sidebar-width: 80px;
        }

        body {
          padding-right: 0;
          padding-bottom: 300px;
        }

        .navbar-custom {
          padding-left: var(--sidebar-width);
        }

        .player-container {
          width: 100%;
          height: auto;
          top: auto;
          bottom: 0;
          left: 0;
          right: 0;
          flex-direction: column;
          padding: 15px 0;
          border-left: none;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-bar {
          width: 200px;
        }

        audio {
          width: 90%;
        }

        .album-poster {
          margin-bottom: 10px;
          width: 120px;
          height: 120px;
        }

        .sidebar .logo a,
        .nav a span {
          display: none;
        }

        .sidebar .logo {
          justify-content: center;
        }

        .nav a {
          justify-content: center;
        }

        .nav a i {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 576px) {
        :root {
          --sidebar-width: 0;
        }

        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .navbar-custom {
          padding-left: 0;
        }
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Logo -->
      <div class="logo">
        <i class="bx bx-pulse"></i>
        <a href="#!">BEATWAVE</a>
      </div>
      <!-- Nav -->
      <nav class="nav">
        <!-- Nav top -->
        <div class="nav-top">
          <ul>
            <li>
              <a href="#!">
                <i class="bx bx-library"></i>
                <span>Thư viện</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bx-bolt-circle"></i>
                <span>Khám phá</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bx-trending-up"></i>
                <span>Bảng xếp hạng</span>
              </a>
            </li>
          </ul>
        </div>
        <!-- Nav bottom -->
        <div class="nav-bottom">
          <ul>
            <li>
              <a href="#!">
                <i class="bx bx-category bx-rotate-270"></i>
                <span>Chủ đề & thể loại</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bx-history"></i>
                <span>Nghe gần đây</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bxs-heart"></i>
                <span>Bài hát yêu thích</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bxs-playlist"></i>
                <span>Playlist</span>
              </a>
            </li>
            <li>
              <a href="#!">
                <i class="bx bx-album"></i>
                <span>Album</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
      <div class="container-fluid">
        <div class="left-header">
          <button class="btn btn-back">
            <i class="bx bx-arrow-back"></i>
          </button>
          <button class="btn btn-forward">
            <i class="bx bx-arrow-back bx-flip-horizontal"></i>
          </button>
        </div>

        <div class="d-flex align-items-center">
          <div class="search-bar me-3">
            <i class="fas fa-search me-2"></i>
            <input type="text" placeholder="Tìm kiếm bài hát..." />
          </div>

          <button class="btn btn-sm btn-login px-3">
            <i class="fas fa-user me-1"></i>
            <a href="DangNhap.jsp">Đăng nhập</a></button
          >-
        </div>
      </div>
    </nav>

    <div class="player-container">
      <div class="album-poster" id="albumPoster">
        <img src="" alt="Album cover" id="posterImage" />
      </div>

      <div class="visualizer">
        <div class="bar" style="animation-delay: 0.1s; height: 30%"></div>
        <div class="bar" style="animation-delay: 0.3s; height: 50%"></div>
        <div class="bar" style="animation-delay: 0.5s; height: 70%"></div>
        <div class="bar" style="animation-delay: 0.2s; height: 40%"></div>
        <div class="bar" style="animation-delay: 0.4s; height: 60%"></div>
        <div class="bar" style="animation-delay: 0.6s; height: 45%"></div>
        <div class="bar" style="animation-delay: 0.1s; height: 35%"></div>
      </div>

      <p id="song-title">Đang phát: Chưa chọn bài hát</p>
      <audio id="audio" controls></audio>

      <div class="player-controls">
        <button onclick="prevSong()">
          <i class="fas fa-step-backward"></i>
        </button>
        <button onclick="playPause()" id="playBtn">
          <i class="fas fa-play"></i>
        </button>
        <button onclick="nextSong()">
          <i class="fas fa-step-forward"></i>
        </button>
      </div>
    </div>

    <!-- <div class="container">
      <h2 class="my-4">Playlist Nổi Bật</h2>
      <div class="row" id="albumList">
        Album cards will be inserted here by JavaScript
      </div>
    </div> -->

    <!-- <%
        // Lấy danh sách nhạc từ database
        NhacDAO nhacDAO = new NhacDAO();
        ArrayList<Nhac> danhSachNhac = nhacDAO.selectAll();
        
        // Tạo đối tượng Gson
        Gson gson = new Gson();
        
        // Chuyển danh sách nhạc thành JSON
        String jsonNhac = gson.toJson(danhSachNhac);
    %> -->

    <!--<script>
      // Chuyển JSON từ Java sang JavaScript
       const danhSachNhacDB = <%= jsonNhac %>; 

      // Tạo mảng albums từ database
      const albumsFromDB = danhSachNhacDB.map((nhac) => ({
        title: nhac.tenNhac || "Không có tên",
        artist:
          (nhac.ngheSi && nhac.ngheSi.tenNgheSi) || "Nghệ sĩ không xác định",
        image:
          nhac.hinhDaiDien ||
          "https://via.placeholder.com/300x180/282828/FFFFFF?text=Không+có+ảnh",
        song: nhac.duongDan || "",
      }));

      // Dữ liệu hardcoded (nếu cần)
      const hardcodedAlbums = [
        /*  { 
                 title: "Exit Sign", 
                 artist: "HIEUTHUHAI", 
                 image: "https://cloud.appwrite.io/v1/storage/buckets/67e38fcb0034ab17ef07/files/67e3903700337be6258c/view?project=67debda60034b16e5e45&mode=admin", 
                 song: "https://cloud.appwrite.io/v1/storage/buckets/67debdb40028fa6f759d/files/67f5179a00288f8491d0/view?project=67debda60034b16e5e45&mode=admin" 
             },
             // Thêm các bài hát hardcoded khác nếu cần */
      ];

      // Kết hợp cả 2 mảng (database + hardcoded)
      const allAlbums = [...hardcodedAlbums, ...albumsFromDB];

      // Phần JavaScript xử lý hiển thị và phát nhạc
      const albumList = document.getElementById("albumList");
      const audio = document.getElementById("audio");
      const songTitle = document.getElementById("song-title");
      const playBtn = document.getElementById("playBtn");
      const albumPoster = document.getElementById("albumPoster");
      const posterImage = document.getElementById("posterImage");
      let currentSongIndex = 0;
      let isPlaying = false;

      // Tạo thẻ card album
      function createAlbumCard(album, index) {
        const col = document.createElement("div");
        col.className = "col-md-4 col-lg-3 mb-4";

        const img = document.createElement("img");
        img.className = "card-img-top";
        img.alt = album.title;
        img.onerror = function () {
          this.src =
            "https://via.placeholder.com/300x180/282828/FFFFFF?text=Không+có+ảnh";
        };
        img.src = album.image;

        const card = document.createElement("div");
        card.className = "card h-100";

        const cardBody = document.createElement("div");
        cardBody.className = "card-body";

        const title = document.createElement("h5");
        title.className = "card-title";
        title.textContent = album.title;

        const artist = document.createElement("p");
        artist.className = "card-text";
        artist.textContent = album.artist;

        cardBody.appendChild(title);
        cardBody.appendChild(artist);
        card.appendChild(img);
        card.appendChild(cardBody);
        col.appendChild(card);

        col.addEventListener("click", () => playSong(index));
        return col;
      }

      // Hiển thị tất cả album
      function displayAlbums() {
        albumList.innerHTML = "";
        allAlbums.forEach((album, index) => {
          const albumCard = createAlbumCard(album, index);
          albumList.appendChild(albumCard);
        });
      }

      // Phát bài hát
      function playSong(index) {
        currentSongIndex = index;
        const currentAlbum = allAlbums[index];

        audio.src = currentAlbum.song;
        songTitle.textContent =
          "đang phát: " + currentAlbum.title + "-" + currentAlbum.artist;
        posterImage.src = currentAlbum.image;

        audio
          .play()
          .then(() => {
            isPlaying = true;
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            albumPoster.classList.add("playing");
          })
          .catch((e) => console.error("Lỗi phát nhạc:", e));
      }

      // Play/Pause
      function playPause() {
        if (audio.paused) {
          audio.play().then(() => {
            isPlaying = true;
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            albumPoster.classList.add("playing");
          });
        } else {
          audio.pause();
          isPlaying = false;
          playBtn.innerHTML = '<i class="fas fa-play"></i>';
          albumPoster.classList.remove("playing");
        }
      }

      // Bài hát tiếp theo
      function nextSong() {
        currentSongIndex = (currentSongIndex + 1) % allAlbums.length;
        playSong(currentSongIndex);
      }

      // Bài hát trước đó
      function prevSong() {
        currentSongIndex =
          (currentSongIndex - 1 + allAlbums.length) % allAlbums.length;
        playSong(currentSongIndex);
      }

      // Xử lý sự kiện khi audio play/pause
      audio.addEventListener("play", () => {
        isPlaying = true;
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        albumPoster.classList.add("playing");

        const bars = document.querySelectorAll(".bar");
        bars.forEach((bar) => (bar.style.animationPlayState = "running"));
      });

      audio.addEventListener("pause", () => {
        isPlaying = false;
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        albumPoster.classList.remove("playing");

        const bars = document.querySelectorAll(".bar");
        bars.forEach((bar) => (bar.style.animationPlayState = "paused"));
      });

      // Hiển thị album khi trang tải xong
      document.addEventListener("DOMContentLoaded", displayAlbums);
    </script> -->
  </body>
</html>
